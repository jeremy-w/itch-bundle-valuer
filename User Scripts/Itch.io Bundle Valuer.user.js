// ==UserScript==
// @name        Itch.io Bundle Valuer
// @description Computes the value in a charity bundle of un-owned games.
// @match       https://itch.io/b/*
// ==/UserScript==
(async function itchBundleValuer() {
    'use strict';
var ownedGameIds = new Set([1000429,1000537,1001091,1001294,1001385,1001807,1002312,100273,1002775,1003561,1003610,10039,1004811,1004856,1004899,1005752,1005791,1006122,1006154,1006165,1008648,1009403,1009625,1009638,1009872,1009890,1010889,1010944,1011128,1011216,1011814,1011901,1012263,1012805,1013143,1013828,1014058,1014929,1015119,1015358,1015362,1015698,1017147,1017498,1017860,1018736,1018753,1019699,1020192,1020372,1021122,1021694,1022384,1022633,1022887,1022905,1022924,1023140,1023205,1023308,1023527,1023923,1023947,1023962,1025318,102605,1026389,1026722,1026940,1026983,1027038,1027273,1027579,1028233,1028291,1028696,1030309,1031392,1031450,1032335,1032466,1033396,1033718,1034161,1034249,1034263,10344,1034645,10349,1035376,1035534,1035693,1036149,1037475,1037827,1038695,1038839,1038932,1039691,1039720,1040366,1040586,1040867,1041012,1041013,1041031,1041300,1041499,1041680,1041734,1041781,1042032,1042138,1042195,1042297,1044078,1044500,1045303,1045320,1045988,1046065,1046163,1046850,1047016,1047302,1047442,1047456,1047607,1048013,1048066,1048177,1048977,1049206,1049455,1049818,1050284,1050884,1050969,1051275,1051445,1051629,1051659,1051759,1051767,1051786,1053778,1053830,1054017,1054593,1055483,1055631,1056172,1056182,1056270,1056489,1056730,1057054,1057362,1057579,1058067,1059090,1059899,1059932,1061600,1061645,1062661,1062964,1063217,1063743,1064213,1064463,1065519,1065580,1068357,1069010,1069561,1069865,1070063,1070269,1070381,1070633,1070766,107078,1070958,1070992,1071560,1071688,1071750,1071768,1072164,1072401,1072699,1072949,1073076,1073094,1073309,1074385,1074536,1074698,1074740,1075531,1075874,1076081,1076122,1077002,1077284,1077987,1078375,1078493,1078715,1079275,1079858,1080663,1080854,1080950,10812,1081846,108545,108620,1088318,1088356,1088389,1088781,1088800,1089217,1089792,1090083,1090137,1090541,1091517,1091634,1091654,1092220,1092501,1092630,1092676,1092994,1093158,1093210,1094174,1094183,1095018,1095026,1095591,1095867,1096086,1096256,1096517,1096710,1097055,109710,1097122,1097124,1098542,1099261,1100516,1100548,1100782,1100804,1100927,1102187,1102260,1102951,1104138,1104143,1104809,1105536,1105768,1105868,1106918,1107214,1107410,1107556,1107778,1108217,1108542,1109228,1109548,1109714,1110316,1111468,1111885,1112187,1112231,1112568,1113263,1113363,1113943,1114262,1114289,1114405,1114485,1114829,1115374,1116118,1116210,1116213,1116350,1116399,1116712,1116885,1117017,1117693,1120158,1121389,1121763,1122676,1123908,1124135,1124141,1124164,112437,1125300,1126204,1126316,1126372,1126423,1126727,1127363,1127453,1128265,1128347,1129415,1129448,1129547,1130587,1131183,1131343,1131706,1132127,1132896,1132917,1133900,1133920,1134082,1134119,1134132,1134231,1134638,1134858,1134871,1134998,1135078,1135339,1135399,1135401,1136471,1136877,1136941,1137333,1138517,1138540,1138849,1138976,1139355,1139856,1140101,1141256,1141501,1141529,1141880,1142129,1142298,1142456,1143113,1143219,1143490,1143660,1143735,1143993,1144029,1144293,1144500,1144707,1145159,1145271,1145326,1145889,1145936,1146169,1146515,1146550,1146879,1147648,1147791,1147934,1148826,1148843,1149607,1149636,1150296,1150467,1150552,1151060,1151083,1151086,1151155,1151215,1151440,1151525,1152022,1152046,1152147,1152323,1152444,1152503,1152974,1153458,1153507,1154046,1154346,1154884,1155087,1155182,1155335,1156094,115627,1156290,1156397,1156759,1157920,1158144,1158462,1158667,1159029,1159305,1159863,1160124,1161486,116158,1161601,1161772,1161963,1162070,1162100,1162115,1162142,1162501,1162590,1162627,1162634,1162988,1162993,1163073,1163541,1163707,1163825,1163939,1164080,1164189,1164799,1165032,1165115,1165118,1165165,1165429,1165991,1166326,1166685,1166717,1167543,1167580,11688,1168996,1169288,1169590,1169657,1170241,1170643,1171178,1171379,1171579,1172650,1173163,1173680,1175894,1175927,1176648,1176809,1179236,1179294,1179744,1180086,1180199,1180291,1180656,1181038,1181429,1181646,1182201,1182289,118243,1182604,1182947,1183066,1183366,1183474,1183767,1183832,1183969,1184632,1185131,1185172,1185269,1185351,1185369,1185461,1185602,1185681,1185881,1186377,1186718,1187199,1187731,1187951,1187981,1188044,1188301,1188530,1188727,1188826,1189139,1190528,1190617,1190792,1191136,1191302,1191456,1191636,1191640,1191978,1192494,1193059,1193236,1193278,1193352,1193878,1193937,1194609,1194750,1195339,1195488,1195526,1195751,1196420,1196705,1196772,11970,1197130,1197559,1197949,1198021,1198221,1198314,1198570,1198578,1198806,1199059,1199128,1199193,1200070,120015,1200291,1200626,1200888,1201408,1201533,1202174,1202324,1202601,1202658,1202874,1203185,1203655,1203731,1204266,1204286,1204398,1204562,1204959,1205223,1206001,1206737,1206855,1207119,1207413,1207441,1207449,1207467,1207477,1207743,1208034,1208326,1208495,1208737,1208740,1209333,1209839,1210264,1210506,1210750,1212405,1212708,1212816,1212937,1212963,1212979,1212985,1213199,1214334,1214651,121472,1214777,1214904,121503,1215329,1215389,1215639,1215668,1215752,1215791,1215866,121614,1216172,1216209,1216628,1216700,1216702,1216807,1216808,1217150,1217527,1218036,1218479,1218749,1219146,1219534,1219715,1220148,1220170,1220517,1222635,1222751,1222910,1222958,1223501,1224248,1225206,1225806,1226223,1226228,1226308,1226505,1226789,1227464,1227620,1227682,1228381,1228493,1229638,1229673,1230147,1230521,1231251,1231593,1231624,1231844,1231860,123218,1232344,1233086,1233090,1233292,1233456,1233630,1233747,1233780,1233791,1233802,1233816,1233817,1233818,123413,1234332,1235586,1235768,1235883,1235986,1236124,1236176,1236829,1236831,1237157,1237855,1237860,1237927,1238087,123839,1239324,1239541,1239990,1240015,1240610,1240899,1241067,1241995,1242338,1242585,124280,1243302,1243471,1243677,1244206,1244306,1244310,1244371,1244471,1244486,1244642,1244710,1244909,1245605,1246252,1248497,1248770,1248885,1249010,1249261,12496,1250206,1250668,1251278,1251540,1251739,1251835,1252105,1252790,1252934,1252954,1253371,1253403,1253499,1253781,1253782,1253824,1254325,1254370,1254584,1254633,1254659,1254677,1254877,1255085,1255279,1255351,1255363,1255623,1255932,1256637,1256812,1256831,1257270,1257575,1258432,1259127,1259159,1259204,1259327,1259439,1260097,1260500,1260590,1261651,1262284,1262339,1262448,1262618,1262834,1263129,1264721,1265280,1265298,1265693,1266375,1266924,1268853,1268893,1269964,1270773,1270957,1271625,1271682,1271971,1272181,1272516,1272626,1272627,1272835,1272911,12732,1273508,1273523,1273526,1273988,127400,1274026,1274316,1274904,1276527,1276894,1277272,1277277,1277392,1278473,1278866,1280404,1280520,128071,1280938,1280942,1281068,1281099,1281288,128211,1282125,1282370,1283008,1283085,1283723,1283775,1284173,1284346,1285319,1285427,1286011,1286265,1286302,1287439,1287878,1288384,1288834,1288863,1288876,1288970,128939,1289468,1289672,1290104,1290212,1290449,1292274,1292487,1292492,1292993,1293058,1293600,1294021,1294201,129425,1294810,1294818,1294958,1296031,1296040,1296133,1296607,1296640,1297380,1297402,1297671,12981,1298302,1298374,1299073,1299325,1299588,1299705,1300089,1300179,1300477,1300495,1300550,1300637,1300932,1301421,13021,1302409,1302872,1303710,1304341,13048,1305201,1306106,1306228,1306300,1306420,1306423,1307036,1307429,1307667,1307741,1308860,1308985,1309321,1309349,1309443,130956,1309590,1310223,1310240,1310294,1310364,1310480,1310573,1310755,131076,1311210,131126,1311442,1312257,1312529,1312665,1312916,1313142,1313189,1313269,1313530,1313603,1314207,1314276,1314875,1315807,1315834,1316000,1316795,1317420,1317423,1318167,1319419,1319504,1320009,1320240,1320556,1320603,1320839,1320969,1321068,1321292,1321950,1322362,1323050,1323362,1323378,1323833,1324485,1324606,1325277,132629,1326425,1326614,1326858,13269,1326940,1327033,1327141,1327357,1327515,1327587,1327614,1328754,1328853,1328927,1329032,1329607,1329720,1329730,1329755,1329970,1330019,1330042,1330225,1330894,1330983,1331057,1331699,1331834,1332457,1332474,1332763,1332792,1332815,1333336,1333488,1333597,1333600,1333748,1334078,1334092,1334229,1334242,1334552,1334821,1334889,1335130,1335263,1335322,1335424,1335431,1335503,1335616,1335682,1335799,1335830,1336227,1336432,1336449,1336508,1336517,1336714,1337074,1337269,1337295,1337503,1337587,1337688,1337711,1337749,1337800,1337823,1337833,1337846,1337944,1338083,1338152,1338310,1338590,1338712,1338765,1339033,1339174,1339383,1339395,1339477,1340143,1340387,1340609,1340731,1341490,1341514,1341825,1342359,1342378,1342532,1342589,1342768,1342803,1342944,1343261,1343308,1344271,134443,1344679,1344954,1345237,1345723,1346265,1346305,1346399,1346515,134756,1347628,1348298,1348649,1348679,1349307,1349532,1349798,1350013,1350094,1350467,1350939,1351136,1351617,1352229,1352275,1352293,1352382,1352654,1352814,1353139,1353764,1353771,1353809,1353887,1354014,1354019,1354693,1354928,1354959,1355434,1355709,1355789,1356600,135677,1357140,1357671,1357983,1358075,1358099,1358584,1358712,1358734,1359184,1359469,1359614,1359836,1359881,1359909,1361960,1362155,1362375,1362445,1363067,1363712,1364009,1364121,1364401,1364635,1365416,1366812,1367425,1367551,1367756,1367830,1367917,1368285,1368929,1369445,1369554,1369563,1369565,1369790,1369865,1370264,1370484,1370897,1371169,1371175,1371293,1371299,1371320,1371362,1371577,1371740,1371761,1371839,1371906,1371924,1372182,1372275,1372800,1372837,1372918,1373069,1373552,1373610,1374144,1374320,1374633,1375071,1375115,1375978,1376175,1376305,1376351,1376463,1376931,1377034,1377094,1377448,1378268,1378546,1378746,1379273,1379788,1379790,1379948,1379966,1380010,1380198,1380339,1380681,1381164,1381833,1381946,1382054,1382848,1382910,138315,1383318,1383799,1385159,1385599,1385943,1385965,1386292,1386449,1386601,1387028,1388105,1388434,1388859,1389154,1389312,1390269,1390322,1390526,1390556,1390605,139067,1390728,1390939,1391972,1392084,1392461,1392554,1393081,1393448,1394258,1394407,1395015,1395263,1395820,1397351,1397385,1397485,1397710,1397831,1398425,1398995,139949,1399564,1399971,1400001,1400173,1400207,1400286,1400331,1400727,1401018,1401183,1401640,1401974,1402891,1403008,1403243,1403309,1404416,1404650,1404887,1405144,1405685,1405907,1406059,1406110,1406215,1406264,1406340,1406486,1407152,1407716,1407814,1408033,1409444,1409626,1409725,1410025,1410356,1410653,1411641,1411938,1412300,1412800,1413585,1414128,1414214,1414770,1414890,1415097,1415674,1415990,1416071,1416079,1416141,1416391,1416473,1416602,1417230,1417485,1417635,1417641,1417651,1417736,1417905,141830,1418488,1418496,1418603,1418802,1419262,1419332,1419386,1419410,1419547,1420290,1421176,1421202,1421220,1421505,1421528,1421578,1421985,1422022,142210,1422169,1422210,1422339,1422484,1422774,1422811,1422981,1423479,1424011,1424143,1424167,1424174,1424223,1424258,142433,1424447,1425091,1425261,1425265,1425368,1425405,1425655,1425933,1426316,1426437,1426509,1426796,1426806,1426942,1427095,1427133,1427151,1427205,1427217,1427298,1427618,1427757,1427775,1427835,1428042,1428111,1428247,1428314,1428383,1428534,1429525,1429669,1429726,1429959,1430090,1430108,1432463,1433060,1433542,1433559,1433671,1433912,1433968,1433970,1433985,1433986,1433991,1433992,1434011,1434809,1435104,1435188,1435774,1436268,1436289,1436477,1436534,1437203,1437557,1437611,1437780,1438243,1438356,1438628,1438853,1439156,1439448,1439458,1440571,1440790,1440938,1441248,144151,1441677,1442180,1443099,1443157,1443213,1443311,1443356,1443900,1444238,1444314,1444377,1444450,1444464,1444499,1444538,1444656,1445494,1445853,1445869,1446675,1446826,1446946,1447026,1447640,1447660,1447676,1448257,1448343,1448604,1448719,144873,1449184,1450547,1450598,1450939,1451118,1451685,1451686,1451980,1452107,1452148,1452159,1452273,1452366,1452449,1452499,1452722,1452849,145326,1453340,1453598,1454436,1455084,1455143,1456520,1456637,1457291,1457300,1457970,1458418,1458656,1459861,1460318,1460402,1460500,1460772,1460855,1461456,1461577,1462741,1462744,1463230,1463320,1463335,1463359,1463397,1463474,1463483,1463490,1463603,1463912,1464508,1464786,1464841,1464924,1464941,1465279,1465878,1466211,1466389,1466593,1466873,1467162,1467591,1467728,1467793,1467844,1468019,1468151,146853,1468673,1469780,1469944,1470389,1470403,1470489,1470498,1470505,1470511,1471174,1471614,1472586,1473099,1473123,1473362,1473501,147359,1473654,1473806,1473846,147395,1474358,1474529,1474535,1474546,1474873,1475123,1475226,1475610,1476333,1476612,1476653,1476735,1476847,1476849,1476945,1476992,1477108,1477591,1478149,1478780,1479303,1479376,1479421,1479605,1479649,1479787,1479877,1480011,1480017,1480128,1480509,1480526,1480556,1480669,1480691,1480713,1480931,1481071,1481154,1481360,1481453,1482691,1482849,1482854,1483246,1483357,1483953,1484323,1484534,1485236,1485265,1485596,1486292,1486323,1486422,1486471,1486660,1487234,1487260,1487289,1487376,1487401,1487547,1487786,1488193,1488256,1488549,1488726,1489028,1489314,1489669,1489682,1490051,1490516,1490544,1490884,1491075,1493068,1493438,1493727,1494249,1494409,1495106,1495176,1495279,1495564,1495907,1496207,1496396,1496398,1496724,1496733,1497064,1497796,1497862,1498223,1498615,1498644,1498983,1499356,1499745,1500343,1500366,1500402,1500440,1500775,1500970,1500986,1501141,1501523,1501542,1501565,1501800,1501942,1501990,1502200,1502679,1502756,1502772,1502843,1503774,1503804,1503990,1504023,1504042,1504108,1504181,1504682,1504819,1504904,1504986,1505271,1505320,1505459,1505942,1506146,150631,1506426,1506445,1506500,1506697,1506843,1507125,1507143,1507269,1507321,1507746,1507775,1508058,1508201,1508246,1508513,1508564,1508588,1508657,150868,1508814,1509041,1509083,1509087,1509347,1509355,1509366,1509368,1509401,1509431,1509601,1509957,1510049,1510189,1510330,1510354,1510439,1510597,1510707,1510734,1510934,1511290,1511419,1511445,1512018,1512191,1512205,1512282,1512741,1512914,1512945,1513004,1513219,1513273,1513377,1513400,1513484,1514061,1514279,1514322,1514369,1514419,1514452,1514501,1514668,1514681,1514688,1514713,1514773,1514848,1514943,1515020,1515076,1515081,1515630,1515632,1515835,1515947,1516022,1516881,1516923,1517029,1517172,1517371,1517579,1517605,1517966,1518202,1518457,1518921,1519029,1519418,1519431,1519516,1519553,1520255,1520337,1521280,1521394,1521439,1521598,1521710,1521871,1522405,1522685,1522816,1522822,1523774,1524204,1524757,1524782,1524833,1525835,1526364,1526566,1526684,1526732,1527043,1527181,1527226,1527857,1527873,152865,1528719,1528836,1528974,1528998,1529007,152934,1529439,1529741,1530032,1530266,1530761,153094,1531150,1531991,1532485,1532848,1532982,1533184,1534745,153505,1535389,1535512,1535518,1535724,1536150,1536362,1536881,1536953,1537470,1537760,1537963,153813,1538936,1539593,1539770,1539846,1540444,1540496,1540498,15411,1541749,1542176,1542303,1542337,1542595,1542627,1542775,1543001,1543134,1543545,1545264,1545684,1546528,1546978,1547046,1547135,1547184,1547319,1547854,1548127,1548197,1548315,1548754,1549164,1549217,1549249,1549274,1549664,1549783,155054,1550653,1552962,1553581,1553670,1553888,1554057,1554308,1554385,1554717,1554981,1555227,1555474,1555780,1555980,1556374,1557157,1557346,1557703,1558608,1558803,1558820,1558885,1558902,1559037,1559165,1559194,1559906,1559918,1560159,1560256,1560446,1560585,1560853,1561226,1562218,1562397,1563152,1564180,1564342,1564514,1564757,1565236,1565956,1565970,1566001,1566414,1566418,1566705,156675,1567224,1567447,1568095,1568243,1569278,1569652,1571127,1571892,1572484,1572595,1572600,1573403,1573665,1574019,1574129,157423,1574720,1575147,1576355,1576654,1577854,1577888,1578653,1578947,1578986,1579019,1579291,1579324,1579425,1579504,1579773,1580370,1582597,1582612,1582712,1583156,1583229,1584517,1584603,1584945,1585683,1585758,1586199,1586252,1586328,1586631,1587146,1588488,1588504,1589008,1589281,1589291,1589575,1589622,1589739,1589875,1590590,1590648,1591527,1591681,1591865,1592232,1592273,1592754,1593239,1593990,1594117,1594208,1594286,1594441,1594743,1595545,1595547,1595739,1595740,1595753,1595814,1595815,1596115,1596624,1596642,1596742,1597029,1597896,1597929,1598028,1598053,1598121,1599013,1599364,1599506,1599890,1599903,1600728,1600764,1601059,1601106,1601416,1601603,1601670,1601880,1602342,1602621,1602924,1603539,1603647,1603695,1604336,1605281,1605332,1605770,1607037,1607231,1609591,1609711,1610309,1610551,1611894,1612211,1612250,1612267,1612832,1613097,1613457,1614119,1614751,1616152,1616350,1616529,1618099,1620869,1626902,1627611,1627639,1628316,1628401,1628569,1628887,1629327,1630556,1630819,1631450,1631848,1632158,1633584,1633965,1635052,1636025,1636214,1636712,1636782,1636861,1637058,1637496,1638019,1638839,1639599,1640029,1640202,1640719,1640736,1641135,1641191,1642255,1642331,1642574,1643113,1644013,1644343,1644377,1645021,1646772,1646790,16476,1647688,1647765,1649981,1650810,1650890,1652632,1653030,1653037,1654821,1654943,1655098,1656308,1656372,1656873,1656986,1658288,1660204,1660402,1660404,1661139,166398,1664106,1664535,1665678,1666953,1666991,1667307,1668048,1668416,1668680,1669100,1669588,1669714,1669763,1669984,1670583,1670795,1670847,1671148,1671388,1672552,16726,1672823,1672826,167413,1675337,1675502,1676278,167647,1677071,167714,1677600,1678662,1678689,1678868,1678949,1678995,1679837,168003,1680152,1680452,1680769,168136,168164,1682085,1682264,1682749,1683777,168507,1685215,1686618,1688373,1689012,1689457,1689748,1691674,1692814,1693418,1693962,1696262,1697191,1697548,169928,1699497,1700053,170019,170020,170081,1700932,1700980,1703160,1704723,1704729,1704896,1705045,1709049,1712049,1713332,1713388,1713885,1714922,1715457,1715589,1715643,1716231,1716915,1720779,1720860,1720991,1721294,1721494,1721607,1722773,1723538,1724035,1724595,1726132,1726249,1726269,1727178,1728082,1728562,1732220,1732412,1732908,1734843,173500,173528,1735777,173796,1738859,1739189,1739254,1739888,1740313,174104,1741365,1742094,1742458,1742835,1742917,1743057,1743063,1743073,1743081,1743175,1743289,1743293,1743294,174401,1744171,1744655,1744746,174506,1745176,1745246,174550,1747115,174838,1748831,1750426,1751323,1751736,1751994,175272,1754726,1754833,1755047,1756313,1757693,1757768,1758645,1758693,1758763,1758796,1759117,1759450,1759605,175967,1760414,1760760,1761208,1761714,1762959,176306,1763564,1763783,176394,1764425,1764830,1764907,1765195,1766256,1766288,1766291,1766298,1766305,1766324,1766328,1767074,1767875,1768368,1768512,1768620,1769189,1769256,1769423,1769849,1769912,1769988,1770483,1770688,1770842,1771546,1771733,1772007,1772279,1772406,177266,1773599,1773667,1776723,1777867,1778059,1778654,1778774,1779183,1781341,1782480,1782656,1782847,1783218,1783369,1783692,1783976,1784750,1785206,1785439,1786046,1786251,1787123,1787179,178735,1787442,1787902,1790419,1792636,1792704,1792719,1793645,1793755,1794067,1794102,1794332,1795332,1795413,179606,1796324,1797143,179780,1797894,17999,1800104,1801343,1803094,1804213,1804231,1804275,1804351,1804741,1805526,180636,180643,1806925,1807358,1807502,1807548,1809259,1810688,1810692,181195,18124,1812625,1813909,1815586,1821880,1822954,1823091,1823109,1823633,1823934,1827568,1827878,1828811,1831670,1832014,1832431,1833712,1834727,1836479,1837231,18387,1842479,18427,1844134,1844239,184456,184508,1845289,1845337,1846782,1846996,1847017,1847520,1848996,1849336,1850995,1851664,1852783,185404,1854212,1854294,1856344,1856936,1856997,1857004,1857422,1857780,1860045,1860155,1860388,1860854,1861012,1861475,1862687,1863784,1863865,1864518,186472,1867968,1868956,1869630,1870705,1870970,1871165,1871621,1871706,1871843,1872581,1873314,1873915,1874081,1874251,1874955,1877232,1878689,1878814,187895,1879865,1880923,188103,1882172,1882345,1882524,1883906,1884353,1885541,1887994,1887999,1888765,1888985,188917,188926,1889758,1890206,1890352,1890564,1890756,1891197,1892441,1893116,189314,1894148,1895186,1895500,1895693,1895805,1896566,189728,1897300,1899131,1899589,1899623,1899649,1900414,1900587,1900785,1901346,1901425,1901618,1902019,1902657,1903263,1903291,1905324,1907730,1908659,1908793,1909980,1914154,1914465,1916379,1917638,1918347,1919520,1920152,1920403,1920764,1920820,1921071,1921416,1921918,1924437,1924591,1924822,1925276,1925434,192675,1927589,1928158,1928557,1929778,1932120,193462,193612,1936470,19366,1936715,1937657,1937780,1938269,1938997,1939460,1941281,1941322,194161,1944060,1944276,1944476,1945669,1946125,1946330,1946344,1947351,1947508,1947881,1948443,1949093,1949287,1950792,1951874,1952358,1952658,1952785,1953128,1955025,1955665,195663,1957039,1957192,1959509,1960798,1962003,196331,1963380,1966849,1967146,1968547,1969099,1969988,1970397,1971880,1971983,1972319,1973877,1974115,1974250,1976115,1976927,1979322,1981507,1981579,1981729,1984119,1984282,1985118,1986141,198681,1988642,1988688,1989162,1989727,1989793,1991336,1991952,1992098,1992776,1993856,199433,19953,1995642,1995677,1995683,1995720,1996531,1996546,1997293,1997331,1997844,1999567,2004439,2005236,2006210,2006281,2007144,2010195,2012691,2012750,2012999,2013377,2015781,2017789,2018648,2023070,2023071,2024805,2027400,2028626,2029032,203044,203323,2033588,203607,2036630,2038082,2040161,2040476,2040896,2040976,2041572,2044651,2045152,2046711,2047455,2049858,2050779,2051346,2051492,205734,2058230,2061120,2061236,2064707,2064960,2065715,2067759,206778,2068411,2070817,2073909,207492,2075036,2075821,207640,2076495,2077304,207765,2078563,207901,208156,2081795,208233,2082480,2082746,2084346,2085415,2086576,2087464,2088261,208895,2089688,2091386,2091719,2094470,2095868,2096142,2097124,2097641,210160,2103326,2103351,2103429,2106194,2106379,2107519,210768,2107826,2112136,211389,2114951,2115378,2118880,2119954,212022,2120814,2120989,2121681,2122785,2122896,2126403,2127005,2127627,2128963,2129083,212978,2131778,2132591,2133138,2133518,2133687,2134507,2136589,2137288,2138036,2138057,2139405,2139431,2139456,2142219,2142430,2143678,2144919,2145210,2145268,2147014,214709,2147550,2149868,2150191,2156396,2165156,216560,216725,216831,216849,2169483,2169582,2169894,216996,217044,2170690,2171842,2171937,2171963,2174014,2174344,2175608,2175793,2176930,2176976,2177031,2177094,2177232,2178790,2178815,2179985,2180335,2181220,2184914,2185297,2185439,2186886,2187180,2187507,2189339,21901,2190435,2191002,2192755,2193185,2193577,2194701,2194723,2196059,2197170,2197190,2197339,2198525,2199643,2199863,2200021,2200175,2200961,2201065,2203533,2203573,2203676,2203873,2204235,2204277,2204838,2207545,2207649,2209337,2209809,2212834,2217095,2217647,2220502,2221028,2221632,2221926,2223129,2224302,2224365,2224975,2226243,2226310,2226766,2227106,2227278,2227327,2227675,2227694,2228436,2228766,2232147,223236,2232458,2234099,223477,2234770,2235031,223522,2235716,223702,2238277,2240758,2241582,2242153,2242620,224352,2243820,2244794,2245326,2250709,2251338,2251941,2254264,2254862,2255327,225800,2258140,2258463,2259601,225997,2260595,2260762,2261469,2262156,226246,2263401,2266727,2267271,2270684,2271407,2272207,2273760,2273880,22755,2275780,2276026,2277306,2277643,2279143,228033,2280686,2280898,2281151,2283786,2283879,2285686,228872,2289007,2289478,2291055,2293065,2293439,2296474,2298530,2304706,2306652,2307194,2308574,2309432,2310227,231116,2312248,231387,231499,231517,2315344,2316127,2316419,231741,231767,2317746,2318401,2318882,2319462,2319949,232164,2323717,2324435,2325163,2325943,2326204,2327965,2332612,2334248,2334740,2337165,2337884,233797,2338750,2341006,2341072,2341998,2342107,2342967,2343047,2344996,2345064,2346819,2346856,235084,2350886,2350936,2357897,2359280,236215,2364475,2365074,2365177,2365179,2365742,2366111,2367116,2367841,2369521,2370124,2370717,2373582,2375178,2375752,2375876,2376853,2377040,2377200,2377277,2383308,2383460,238392,2384217,2387552,2387591,2388162,2389263,2391184,2392952,2394180,239440,2395756,2397828,2399521,239973,2400440,2400601,2400951,240249,2402519,240422,2404436,2404911,2405573,2406684,240797,2412308,2412910,2412958,2413065,2413110,2414778,2415764,2416039,2417489,2418032,2418828,2419239,2422422,2422766,2423071,2425314,2427045,2429664,2429974,2430617,2433223,2435421,243548,2436081,2441268,2441335,2441416,2442198,2444958,244573,244602,2446573,244674,2447464,2447623,2447761,2448426,2449620,2451950,2453236,2453620,2453665,2453858,2454571,2455588,2457625,2457732,2458456,2461010,2461544,2461585,2462323,2462718,2462770,2463147,2465928,2466304,2466461,2466894,2469336,2469454,2470,2470265,2470781,2471586,2472394,2472405,2472428,2472884,2473892,2475609,2475623,2477215,2477537,2477634,2479178,2479350,2479441,2480741,2481041,2482300,2485099,2485976,2487999,2488654,2488893,2490057,24907,2491677,2491903,2494419,24962,2499043,2500996,2502043,2502109,2503110,2503786,250468,2505151,2505225,2505713,2506130,2506716,2508270,2509124,2511369,2514141,2518751,2519052,2520576,2520616,2520737,2520929,252145,2522158,2523142,252359,2525092,2525612,25260,2526077,25265,2529379,2530444,2531160,2532669,2534106,2534454,2535797,2542078,254280,2543058,2544940,2544968,2545506,2548136,254875,255035,2551476,2553088,2553372,2554501,2554861,2555900,2556649,2556927,2556938,2557075,2557684,2558539,2558636,2559147,2564411,2565710,2567701,2567763,256792,2570130,2570866,257263,2574340,2574504,2575740,2575819,2575845,2576607,257679,2578218,2579951,2582512,2585821,2593142,2593412,25945,2596127,2596190,2596257,2596722,2601092,2601230,2605442,2607927,2612223,261430,2631081,263418,263867,265410,26652,268388,268606,268827,270,27123,271280,271925,273269,273523,273686,274192,274784,27487,275529,276325,277240,277310,278098,279704,280003,280042,280368,28037,28038,280562,280566,280918,281426,281927,282335,283271,283494,283495,283628,285260,285805,287724,289086,293054,293199,294962,295293,295808,29655,296812,298014,29872,298905,299352,30028,302201,302696,304124,304927,305627,305721,306544,306585,306985,308849,309120,309301,309365,309400,309634,309919,31060,311993,312054,312312,312345,313181,313322,314559,314708,31485,314867,315009,315772,316111,316515,318110,320009,321109,321184,321312,32135,321610,321850,322138,323290,323685,323856,323955,325107,32738,328317,32996,331260,331869,333465,333552,333943,33467,33496,33617,336742,336785,338215,338522,339563,340583,342,342152,342965,342987,343020,344215,344724,345018,345236,345261,346906,348864,349757,350542,350879,351861,352120,352161,352195,352203,352674,353850,355125,355413,355956,356260,356553,356969,357923,358930,35912,359674,359895,36019,36029,36098,360990,361167,36167,36206,3634,363463,363558,363599,363735,364110,364582,365013,365363,366363,367310,367312,367317,36772,368200,368547,368856,369295,369549,369712,369718,369814,370068,371218,371668,372589,372756,374168,375740,376266,378203,378880,379225,379436,37968,381132,381236,381835,38201,382069,383050,383058,383121,383742,384047,384102,38531,388102,38889,389332,390586,390761,390799,390973,391091,391516,391986,392851,393089,393332,393593,393932,394356,394625,395241,396248,39672,397848,398876,398904,399152,399740,399745,400106,400299,400733,400908,401181,401195,401966,40340,403630,40415,404481,405836,407231,407697,408293,408709,409635,409950,410743,410857,411443,411523,41241,413325,415370,415463,416196,416410,417793,417986,418133,41815,418211,418833,419156,419225,419325,420757,420874,423200,424472,424751,424895,424943,425066,426119,426462,427345,427405,427831,428139,428140,428434,429262,429977,431114,433053,435145,435811,436191,436993,437264,437320,437658,439596,440578,440782,440963,441010,441086,441844,442063,442085,442208,442973,443287,44329,443311,443463,443499,443988,444236,444443,444679,444701,444949,445382,445386,445404,445914,446239,446951,447694,447967,448162,448498,448564,448569,448615,450360,450407,451146,451247,451545,451618,451737,452294,452347,45261,452815,452920,453079,45372,454004,454448,454805,454990,455197,455642,45666,456786,458613,458754,45883,458921,459122,459199,459493,460822,461849,464519,464572,464673,464777,465130,465154,465240,465606,465794,466381,466511,466529,466560,467528,467545,467644,46774,468673,469151,469661,469762,470402,470906,471330,471380,471802,471948,472322,472781,473369,474254,474297,474696,475206,475246,475342,475566,475593,475814,476605,477590,478538,478608,478953,479133,479757,480151,48038,481615,483245,484283,48438,484758,484856,48585,486055,486068,486072,486255,486301,486380,486827,487227,487568,487570,487982,488364,488588,488722,488813,489213,491268,491406,491705,491721,492267,493521,494536,496442,497300,497645,49810,499575,499975,501906,501922,502962,503396,503433,503502,503564,504511,504636,504819,505094,505120,505534,506051,506083,506697,506853,507553,507708,507760,507857,507935,508282,508339,50841,508896,50903,509304,509358,509854,510233,510523,510804,510936,511343,51139,511538,512107,51221,512497,51308,513171,513385,513770,513812,513992,514861,515031,515166,51533,516178,516445,516634,516903,516977,517235,517947,518388,518642,519473,519630,519744,519865,520339,520444,520732,520770,522374,522612,522775,52282,523278,523458,523544,523579,524107,524547,524711,524805,525404,525628,525635,525638,525654,525675,525828,525837,526380,526495,527168,528,528139,528240,52859,529106,529782,529963,531016,532823,532841,53305,533957,534055,534769,534807,534972,536401,537018,537668,538228,538392,538772,540015,540098,540231,540240,540250,540755,541456,541613,541945,542415,542435,542928,543221,543371,543470,543649,543813,544102,544537,544596,545267,545667,545881,546140,546852,54706,547260,547631,548981,549229,549287,549446,55,550477,55066,55125,551309,552465,552732,553490,553810,553939,555485,557010,557089,558111,558218,558287,558309,558370,558708,559711,559745,561144,561742,562799,563054,563546,565400,565699,567637,567984,568018,570088,570191,570390,570842,571125,571594,571810,571817,571996,572282,572630,572823,573624,573722,575723,576,576027,576082,57738,578336,578538,579000,579744,580003,580425,580467,58075,581365,581464,581511,582626,583081,58336,584106,584728,584944,58594,587594,587792,587963,588561,588705,588877,588926,589709,589823,58984,589847,590089,590318,591171,591415,591886,592201,592205,592677,593221,593271,593396,594827,594901,595072,596316,59682,596884,597162,597524,598412,598772,5988,601100,601109,601110,602381,602624,602940,603000,603927,604235,604243,604305,604687,60521,606325,606362,607041,607980,608052,609289,609721,610098,610114,610385,610458,610742,611280,611852,61244,612562,612680,612699,612701,612730,612857,612904,613771,613828,614283,614887,61849,618848,619243,620807,621643,62170,621946,622478,623629,623901,625209,625406,626776,627788,627873,629611,629886,630112,63016,630983,631303,631433,632218,632260,632321,632483,632568,636369,637286,637481,637615,638730,639854,639976,641245,641686,644167,644320,644380,64448,644939,645160,646457,646634,647,647244,647265,647361,648581,648582,650467,651041,651048,651379,652100,652531,65258,652651,652889,652951,653598,654209,654935,655449,657352,657554,65770,657708,657814,65806,658220,658327,658637,658767,659581,659596,660358,66082,661296,661453,661551,662724,662916,663058,663902,663984,664316,664569,664587,664936,665020,665049,665295,665537,665809,665814,667112,667142,667740,668187,668272,668274,668677,669400,669419,669479,669502,669540,669629,669812,670098,670733,671654,672375,672818,672950,673,674588,675440,675462,675652,675761,67597,675978,676202,678722,678727,679161,679475,679973,680088,680113,680303,680489,681132,681388,681457,681505,681749,682309,682315,682887,682954,683412,683459,683739,683872,684472,68463,684710,684780,68521,68607,686149,686355,686606,686830,686840,687084,687285,687706,689222,689367,689843,690044,690179,690195,690692,690786,69104,691660,691827,692435,692446,692483,692495,69257,692914,692934,693231,695484,701270,702216,702790,703446,703811,704313,704474,704791,704868,70495,70550,705790,705927,70696,706965,707177,707251,707313,707575,708083,708382,70839,708436,710059,710308,710839,711272,712403,712822,714041,71471,714859,714882,715825,716880,717135,717147,717300,717403,717809,717964,717988,718411,718653,719402,720096,720210,720476,720714,720892,721003,721809,722810,723129,723434,72345,723648,724122,726140,726422,726467,726668,727305,727376,727387,727946,728131,728289,728347,728457,728536,728817,728828,728897,728971,729292,729424,729679,729902,73014,730335,730498,731182,731374,731398,731589,731775,732334,732354,732988,733158,733490,733631,734283,734289,734333,734340,73439,735190,735339,735417,73562,736090,736163,736379,736383,736978,737019,737643,738528,738875,739110,73914,739469,739563,739588,740041,741067,741088,741148,741783,741810,741915,742108,742208,742277,742462,742607,742869,743233,743492,743629,743843,744305,744314,744340,74468,744825,744916,745706,746629,746955,747061,747397,747607,747856,747913,749003,749156,749382,749512,749583,749690,749838,749855,749860,749864,750107,750180,750246,750461,750684,751022,751622,752530,752551,753818,753946,75553,755562,755614,755826,75594,756128,756470,756478,756609,757079,757505,757611,758005,758105,758472,758843,758860,758907,758991,759167,759465,760548,760746,760873,761017,761113,76194,762357,7633,763903,763993,76416,764262,764795,764950,7661,76746,767777,768616,768722,768791,768885,769501,769635,769867,769881,770335,771948,772306,772350,773006,773237,773259,773361,773883,775280,778097,778232,779579,780084,781541,782012,782101,782360,782575,782626,782772,782777,782931,782961,784312,784315,785097,785468,786239,786251,786469,787403,78751,787510,787596,787887,788129,788161,788403,788768,789140,789758,789804,789961,790754,79102,791246,792330,792457,792490,793403,793955,794371,795761,795827,795936,796,796148,796297,796530,796734,796829,797420,797612,797684,797822,798836,798931,79900,800438,800614,800763,801029,801248,801365,801373,801377,801907,802141,802142,802723,803152,803243,803268,803353,803571,804346,805310,805561,805732,806939,806972,806981,807062,807727,808652,809296,811139,81144,811653,811823,812694,812827,813094,813589,814781,815,815412,815462,815568,815927,818530,818557,821589,821825,822490,823004,823328,823636,824474,825688,825887,826035,826110,826250,828323,828391,830594,83074,831433,831525,831818,831975,831979,832109,832628,832634,832718,832801,833253,833297,83360,83434,834377,834776,834843,834853,835156,835237,835290,83600,836714,836898,837072,838518,838532,838536,839307,839554,840450,840482,840906,841389,841454,841609,841942,842262,842865,842948,843111,843656,843995,844116,844118,844888,845196,845237,845641,845953,845986,846158,84785,84840,848554,848785,84938,84984,84985,850279,852549,852884,853044,853244,853778,855301,855376,855649,856055,856064,856440,857081,857151,857992,858203,859744,860443,861006,861156,861300,861933,862069,862357,862681,863921,864007,864677,864694,864965,865165,865626,866050,867032,867235,867530,867548,867648,867670,867888,86797,868177,86826,868862,86929,869579,870447,870951,871293,871533,871578,871627,871705,872064,873292,873552,873976,874066,874285,874540,874560,874649,874706,874951,875003,875558,875588,875861,876583,876615,876840,876935,877042,87745,877480,877794,877983,878709,879067,879454,880542,88142,882387,882428,882542,883244,883296,88340,883424,883854,885082,885131,885271,885628,885772,885831,885923,886324,886454,886539,886555,887069,888127,888403,888727,889092,889633,889870,889961,890142,890887,891130,891474,891615,891700,891853,891911,892343,892979,893026,89332,893470,89387,894389,894915,894972,895679,895964,896944,898143,898476,898582,898606,898781,899009,899157,899234,899328,899383,899532,899667,899773,900076,900185,901287,901608,904380,904814,906367,907029,908020,908141,909528,909792,909913,909925,91014,910620,911298,91131,911696,911996,91201,913171,913753,914219,914288,914984,915206,915430,915436,916021,916528,918604,918699,918829,919780,920610,920691,920749,920869,921141,9217,921912,92223,922336,922878,923205,923352,923443,923447,924064,924132,925465,926077,927076,927482,927931,930110,930487,930763,932366,932432,933057,933590,933913,935614,935681,936272,936456,937805,938030,939369,939598,939618,939966,940033,941116,941147,941232,941270,941272,941280,941307,941522,941523,942131,942170,942787,944,944699,945403,946483,946690,946788,947497,947565,947650,947748,947874,94812,948803,949286,949342,949737,950401,950570,952798,952901,953461,953833,953882,953891,954046,954438,954587,954735,955665,95710,957287,958430,958508,959076,959160,959773,95983,959945,960187,960348,960515,960836,960924,961607,961608,962095,962654,962802,963223,96338,964107,964202,964435,964623,964730,964983,965484,966256,967318,967385,968731,969005,969374,969404,969757,970048,970188,970237,970726,970846,970866,971520,971676,971828,973086,973215,973403,973954,974964,974992,975086,975147,975479,975805,976446,976670,976772,976898,977629,977812,97782,977873,977924,978046,978107,978221,978420,978483,978582,979144,979316,979380,980099,980157,980483,980756,980949,981423,98206,982117,982283,982778,983597,984207,984350,985204,985231,985440,986687,986717,986809,987266,987395,987945,988194,988403,988619,988635,989252,989950,990069,991210,991585,991647,992475,992974,993481,993948,994932,995638,995771,996175,99668,997159,997479,997757,998150,999294])
let gamesUrl = (location) => {
    const path = location.pathname;
    if (!path.startsWith('/b/')) return '';

    const url = path.replace(/^\/b\/(\d+)\/.*/, '/bundle/$1/games.json')
    return url
}
let addPricesObserver = null;
function addPrices(games) {
    let notAllLoaded = false;
    const markerClass = 'jws-price-suffixed'
    for (const game of games) {
        const titleAnchor = document.querySelector(`[data-game_id="${game.id}"] div.label a`)
        if (!titleAnchor) {
            notAllLoaded = true;
            continue;
        }
        if (titleAnchor.classList.contains(markerClass)) {
            // Already added the price on.
            continue;
        }
        titleAnchor.textContent += ` - ${game.price ?? ''}${game.flag ?? ''}`
        titleAnchor.classList.add(markerClass)
    }
    console.log(`addPrices: notAllLoaded=${notAllLoaded}`)
    if (notAllLoaded && !addPricesObserver) {
        const container = document.querySelector('[data-game_id]').parentElement;
        console.log('addPrices: Establishing mutation observer for further loads.')
        addPricesObserver = new MutationObserver(async (_mutations, _observer) => {
            addPrices(games);
        });
        addPricesObserver.observe(container, { subtree: true, childList: true });
    } else if (!notAllLoaded) {
        console.log('addPrices: All loaded, disconnecting observer.')
        addPricesObserver.disconnect();
    }
}
/*
Possible price strings are:

$3
5.00€
£3
£1.99
R$15 (Brazilian reais)

And probably more, but these are the ones I've seen so far.
*/
let priceEntry = (priceString) => {
  const symbol = priceString.replace(/[0-9.,]/g, "");
  const amount = Number.parseFloat(priceString.replace(/[^0-9.]/g, ""));
  //   console.log(`${priceString} => [${symbol}, ${amount}]`);
  return [symbol, amount];
};
let symbolValues = {
    '$': 1,
    '£': 1.27,
    '€': 1.08,
    'R$': 0.19,
}
let codes = {
  $: "USD",
  "£": "GBP",
  "€": "EUR",
  R$: "BRL",
};
function stickAmountOnPage(msg) {
    if (document.querySelector('#jws-bundle-value')) {
        return;
    }
    const parent = document.querySelector('div.promotion_meta')
    const strong = document.createElement('strong')
    strong.id = 'jws-bundle-value'
    strong.textContent = msg
    const p = document.createElement('p');
    p.appendChild(strong);
    parent.appendChild(p);
}
async function computeBundleValue() {
    console.log(`JWS: Computing bundle value`)
    let loc = gamesUrl(document.location)
    if (!loc) {
        console.error('JWS: no game URL returned');
        return;
    }

    console.log(`JWS: Fetching games.json from ${loc}`)
    const res = await fetch(loc, { credentials: 'same-origin' })
    if (!res.ok) {
        console.error('JWS: failed fetching games.json')
        return
    }
    const {games} = await res.json()
    addPrices(games);
  const unownedGames = games.filter((it) => !ownedGameIds.has(it.id));
  console.log(
    `JWS: Found ${games.length} total games, ${unownedGames.length} unowned games.`
  );
  const value = unownedGames.reduce((accu, game) => {
    try {
      if (game.flag === "free" || game.flag === "web") {
        return accu;
      }
      const [key, value] = priceEntry(game.price);
      if (!accu[key]) {
        console.log(
          `New currency symbol: ${key} - from price string: ${game.price}`
        );
        accu[key] = 0;
      }
      accu[key] += value;
      //   console.log(`Now at ${key}${accu[key]}`);
    } catch (error) {
      console.error(`Failed to price a game.`, { game, error });
    }
    return accu;
  }, {});
  const formatters = Object.fromEntries(
    Object.keys(value).map((currencySign) => [
      currencySign,
      codes[currencySign]
        ? new Intl.NumberFormat("en-US", {
            style: "currency",
            currency: codes[currencySign],
          })
        : undefined,
    ])
  );
  // FIXME: This looks silly when the only currency in use is USD. Omit stringified when that's the case.
  const stringified = Object.entries(value)
    .map(([symbol, amount]) =>
      formatters[symbol]
        ? formatters[symbol]?.format(amount)
        : `${symbol}${amount}`
    )
    .join(", ");
  const approx = Object.entries(value)
    .map(([symbol, amount]) => {
      let approxValueInUsd = symbolValues[symbol];
      if (!approxValueInUsd) {
        console.error(
          `No currency conversion defined in |symbolValues| for symbol: [${symbol}]`
        );
        approxValueInUsd = 1;
      }
      return approxValueInUsd * amount;
    })
    .reduce((accu, it) => accu + it, 0);
  const fmt = new Intl.NumberFormat("en-US", {
    style: "currency",
    currency: "USD",
  });
  const countFmt = new Intl.NumberFormat("en-US");
  const msg = `${countFmt.format(
    unownedGames.length
  )} new games. Approximate total value in USD: ${fmt.format(approx)}${
    stringified ? `, by way of ${stringified}` : ""
  }.`;
  console.log(msg);
  done(msg)
  stickAmountOnPage(msg)
}

console.log('Loaded user script: Itch.io Bundle Valuer')
let done = (_) => {}
let bundleValueMessage = new Promise(resolve => { done = resolve })
const observer = new MutationObserver(async (_mutations, _observer) => {
    const msg = await bundleValueMessage;
    stickAmountOnPage(msg);
});
observer.observe(document, { subtree: true, childList: true });
await computeBundleValue();
})()
